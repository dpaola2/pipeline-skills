# QA Plan — Area Tree Type Headers & Icons

> **Generated by:** Pipeline Stage 7 (QA Plan)
> **Date:** February 6, 2026
> **Branch:** `pipeline/area-tree-type-headers`
> **PR:** TBD
> **Gameplan:** `projects/area-tree-type-headers/gameplan.md`
> **Progress:** `projects/area-tree-type-headers/progress.md`
> **Linear:** [WEB-106](https://linear.app/orangeqc/issue/WEB-106/area-tree-should-have-headers-and-different-icons-for-each-of)

---

## 1. Feature Summary

The Setup > Sites area tree now groups assignable items into three labeled sections — **Inspections**, **Surveys**, and **Checklists** — each with a distinct icon. Previously, inspection forms and surveys were visually identical (same icon, no grouping label), causing customer confusion (Help Scout #11161). This brings the web area tree in line with the section header pattern already used in iOS and Android.

### Milestones Implemented

| Milestone | Description | Commit |
|-----------|-------------|--------|
| M1 | Section headers, icons & Stimulus updates | `cebc815` |
| M2 | QA test data (seed task with 8 area scenarios) | `a80de10` |

---

## 2. Automated Test Coverage

| Metric | Value |
|--------|-------|
| **Total tests** | 16 |
| **Passing** | 16 |
| **Failing** | 0 |
| **Test files** | 2 |

### Test Types

| Type | File | Count | Covers |
|------|------|-------|--------|
| Model spec (new) | `spec/models/inspection_forms_structures_surveys_scope_spec.rb` | 3 | `.surveys` scope — includes surveys, excludes non-surveys, correct count |
| Model spec (existing) | `spec/models/inspection_forms_structures_spec.rb` | 13 | `.non_surveys`, `.active`, `.accessible_to`, `.within_subtrees`, `#remove_future_inspection_events` — regression suite |

### What Automated Tests Verify
- The new `.surveys` scope correctly returns only Survey-type `InspectionFormsStructures` records
- The existing `.non_surveys` scope is not broken by the new scope addition
- All existing model behavior (archiving, accessibility, subtree filtering) is unaffected

---

## 3. Test Data Setup

### Rake Task

```bash
cd ~/projects/orangeqc/orangeqc
bundle exec rake pipeline:seed_area_tree_type_headers
```

The task is idempotent — re-running it detects existing data and prints the summary without duplicating.

### Scenarios Seeded

| # | Area Name | Assignments | Purpose |
|---|-----------|-------------|---------|
| 1 | All Types Room | 1 inspection + 1 survey + 1 checklist | All three section headers visible |
| 2 | Inspections Only Room | 2 inspections | Only "Inspections" header |
| 3 | Surveys Only Room | 2 surveys | Only "Surveys" header |
| 4 | Checklists Only Room | 2 checklists | Only "Checklists" header |
| 5 | Inspections and Surveys Room | 1 inspection + 1 survey | Two headers, no "Checklists" |
| 6 | Empty Room | None | No headers, action buttons visible |
| 7 | Surveys With Children | 2 surveys + 2 child areas | Surveys don't block "Add Area" |
| 8 | Nested Building | Floor 1 (inspection + survey + checklist), Floor 2 (inspection only) | AJAX-loaded children get headers |

### Post-Seed Verification
- [ ] Navigate to http://elm.lvh.me:3000/setup/structures/[site-id] (URL printed by task)
- [ ] Log in as `crash` (existing password) and verify the site appears with 8 top-level areas

---

## 4. Manual Testing Checklist

> Organized by feature area. Each item has steps, expected result, and the acceptance criteria it verifies.

### 4.1 Section Headers — Visibility & Ordering

#### QA-001: All three headers visible
**Criteria:** HDR-001, HDR-004
**Steps:**
1. Navigate to the QA Section Headers Site
2. Click on "All Types Room" to expand it

**Expected:** Three section headers appear in order: "Inspections", then "Surveys", then "Checklists". Each has items listed beneath it.

---

#### QA-002: Headers only appear when items exist
**Criteria:** HDR-002
**Steps:**
1. Expand "Inspections Only Room"
2. Expand "Surveys Only Room"
3. Expand "Checklists Only Room"
4. Expand "Inspections and Surveys Room"

**Expected:**
- Inspections Only Room: only "Inspections" header (no "Surveys" or "Checklists")
- Surveys Only Room: only "Surveys" header
- Checklists Only Room: only "Checklists" header
- Inspections and Surveys Room: "Inspections" and "Surveys" headers (no "Checklists")

---

#### QA-003: No headers when no assignments
**Criteria:** EDGE (no assignments)
**Steps:**
1. Expand "Empty Room"

**Expected:** No section headers appear. The "Assign Inspection Form" and "Assign Checklist" action buttons are visible.

---

#### QA-004: Header styling
**Criteria:** HDR-003
**Steps:**
1. Expand "All Types Room"
2. Compare the section header text ("INSPECTIONS", "SURVEYS", "CHECKLISTS") to the form names beneath them

**Expected:** Section headers are visually distinct — uppercase, smaller font (10px), muted gray color (#999), 600 font weight. They do NOT look like clickable items.

---

#### QA-005: Checklists section requires service_validations_enabled
**Criteria:** HDR-005
**Steps:**
1. Verify the seed task set `service_validations_enabled = true` on the elm account (the task prints this)
2. Expand "All Types Room" — confirm "Checklists" header is visible
3. (Optional) If you want to verify the conditional: in Rails console, set `Account.find_by(subdomain: 'elm').update(service_validations_enabled: false)`, then reload the page — the "Checklists" header and "Assign Checklist" button should disappear

**Expected:** "Checklists" section only appears when the account has `service_validations_enabled = true`.

---

### 4.2 Distinct Icons

#### QA-006: Inspection form icon
**Criteria:** ICN-001
**Steps:**
1. Expand "Inspections Only Room"
2. Look at the icons next to each inspection form name

**Expected:** Each inspection form has a `fa-file-alt` icon (document/page icon).

---

#### QA-007: Survey icon
**Criteria:** ICN-002
**Steps:**
1. Expand "Surveys Only Room"
2. Look at the icons next to each survey name

**Expected:** Each survey has a `fa-poll-h` icon (horizontal bar chart icon) — distinct from the inspection form icon.

---

#### QA-008: Checklist icon
**Criteria:** ICN-003
**Steps:**
1. Expand "Checklists Only Room"
2. Look at the icons next to each checklist name

**Expected:** Each checklist has a `fa-clipboard-list-check` icon (clipboard with checkmarks).

---

### 4.3 Assign/Unassign via Tree Dropdown

#### QA-009: Assign inspection form inserts into correct section
**Criteria:** INT-001, INT-004
**Steps:**
1. Expand "Empty Room" (no assignments)
2. Click "Assign Inspection Form"
3. Select a form from the dropdown and click "Save"

**Expected:** An "Inspections" section header appears dynamically, and the new form appears beneath it with the `fa-file-alt` icon. The form is NOT placed under "Surveys".

---

#### QA-010: Assign inspection form to area that already has inspections
**Criteria:** INT-001, GRP-002
**Steps:**
1. Expand "Inspections Only Room" (already has 2 inspections)
2. Click "Assign Inspection Form" and assign a new form

**Expected:** The new form appears under the existing "Inspections" header, sorted alphabetically by name.

---

#### QA-011: Unassign last inspection form
**Criteria:** EDGE (last inspection removed)
**Steps:**
1. Expand "Inspections Only Room"
2. Click on one inspection form to select it, then click the trash icon to unassign it
3. Repeat for the second inspection form (so the area has zero inspections)

**Expected:** After the last inspection is removed, the "Inspections" section header disappears. The "Add Area" button becomes visible (since no non-survey forms remain).

---

#### QA-012: Assign checklist creates section dynamically
**Criteria:** INT-004, BUG-FIX
**Steps:**
1. Expand "Empty Room" (or any area with no checklists)
2. Click "Assign Checklist"
3. Select a checklist and click "Save"

**Expected:** A "Checklists" section header appears dynamically, and the new checklist appears beneath it with the `fa-clipboard-list-check` icon. The checklist sort works correctly (verifying the `checklist` → `checklists` target fix).

---

#### QA-013: Unassign last checklist
**Criteria:** EDGE (section disappears)
**Steps:**
1. Expand "Checklists Only Room"
2. Click a checklist to select it, then click the trash icon to unassign it
3. Repeat for the second checklist

**Expected:** After the last checklist is removed, the "Checklists" section header disappears.

---

### 4.4 Surveys — Special Behavior

#### QA-014: Surveys don't block "Add Area"
**Criteria:** INT-005, EDGE (surveys + children)
**Steps:**
1. Expand "Surveys With Children"

**Expected:** The "Surveys" header is visible with 2 surveys listed. The "Add Area" button is also visible (NOT hidden). Child areas (Child Area A, Child Area B) are visible. Surveys are exempt from the `hide_new_area` logic — only non-survey inspection forms block "Add Area".

---

#### QA-015: Survey right-pane assignment (tree doesn't update live)
**Criteria:** INT-006
**Steps:**
1. Click on "Empty Room" to select it (right pane loads)
2. In the right pane, scroll to the Surveys section and assign a survey
3. Observe the tree — the area tree does NOT update live
4. Collapse "Empty Room" by clicking it, then click it again to re-expand

**Expected:** After collapsing and re-expanding, the newly assigned survey appears under a "Surveys" header with the `fa-poll-h` icon. The tree NOT updating live on right-pane assignment is pre-existing behavior and is expected.

---

#### QA-016: Unassign last survey
**Criteria:** EDGE (last survey removed)
**Steps:**
1. Expand "Surveys Only Room"
2. Click a survey to select it, then click the trash icon to unassign it
3. Repeat for the second survey

**Expected:** After the last survey is removed, the "Surveys" section header disappears.

---

### 4.5 Expand/Collapse & AJAX Children

#### QA-017: Expand and collapse behavior unchanged
**Criteria:** INT-002
**Steps:**
1. Click on "All Types Room" to expand it (arrow points down)
2. Click on "All Types Room" again to collapse it (arrow points right)
3. Click again to re-expand

**Expected:** Node expands and collapses normally. All three sections are visible when expanded. No visual glitches or layout shifts.

---

#### QA-018: AJAX-loaded children get section headers
**Criteria:** EDGE (AJAX children)
**Steps:**
1. Expand "Nested Building"
2. Expand "Floor 1" (loaded via AJAX)
3. Expand "Floor 2" (loaded via AJAX)

**Expected:**
- Floor 1 shows all three headers: "Inspections" (1 form), "Surveys" (1 survey), "Checklists" (1 checklist)
- Floor 2 shows only "Inspections" header (1 form)
- Headers on child nodes have the same styling as headers on top-level nodes

---

### 4.6 Sort Order

#### QA-019: Alphabetical sort within sections
**Criteria:** GRP-002, GRP-003
**Steps:**
1. Expand "All Types Room"
2. Assign additional forms/surveys via the tree dropdown to create multiple items per section
3. Verify each section sorts alphabetically

**Expected:** Items within each section (Inspections, Surveys, Checklists) are sorted alphabetically by name.

---

## 5. Edge Cases & Boundary Conditions

| # | Scenario | How to Test | Expected Result | Criteria |
|---|----------|-------------|-----------------|----------|
| 1 | Area with only surveys assigned | Expand "Surveys Only Room" | Only "Surveys" header; no "Inspections" or "Checklists" header | EDGE |
| 2 | Area with only checklists assigned | Expand "Checklists Only Room" | Only "Checklists" header | EDGE |
| 3 | Area with no assignments | Expand "Empty Room" | No headers; action buttons visible | EDGE |
| 4 | Last inspection removed from area | Unassign all inspections from "Inspections Only Room" | "Inspections" header disappears; "Add Area" re-appears | EDGE |
| 5 | Last survey removed from area | Unassign all surveys from "Surveys Only Room" | "Surveys" header disappears | EDGE |
| 6 | Last checklist removed from area | Unassign all checklists from "Checklists Only Room" | "Checklists" header disappears | EDGE |
| 7 | Surveys + children on same area | Expand "Surveys With Children" | "Surveys" header visible AND "Add Area" visible (not blocked) | INT-005 |
| 8 | AJAX children inherit headers | Expand "Nested Building" → "Floor 1" | Floor 1 shows section headers with same styling | EDGE |
| 9 | Dynamic section creation (first assignment) | Assign inspection form to "Empty Room" | "Inspections" section created dynamically with header + list | INT-004 |

---

## 6. Known Limitations

Items explicitly deferred or not implemented in this version:

| Item | Status | Notes |
|------|--------|-------|
| Section header counts (e.g., "Inspections (3)") | Not included | PRD Open Question #1 — decided "no" for cleanliness |
| Section header icons | Not included | PRD Open Question #2 — icons on individual items are sufficient |
| Drag-and-drop reordering between sections | Out of scope | PRD Section 10 |
| Section collapse/expand within a node | Out of scope | Sections are always visible when the node is expanded |
| Right-pane survey changes updating tree live | Pre-existing behavior | Tree updates only on next expand/collapse (server re-render) |
| Changing icons in other parts of the app | Out of scope | Only the area tree was changed |

---

## 7. Regression Concerns

Areas where existing functionality could be affected by this change:

| Area | Risk | What to Check |
|------|------|---------------|
| Inspection form assign/unassign via tree dropdown | **Med** | Stimulus controller methods were refactored. Verify QA-009 through QA-011. |
| Checklist assign/unassign via tree dropdown | **Med** | Target name changed from `checklist` to `checklists`. Verify QA-012, QA-013. |
| Area tree expand/collapse | **Low** | DOM structure changed (new wrapper `<div>`s). Verify QA-017. |
| "Add Area" button visibility | **Med** | Un-hide logic was updated to check only inspections (not surveys). Verify QA-011, QA-014. |
| `sortInspectionForms()` | **Low** | Still targets `inspectionFormsTarget` which now contains only inspections. Verify QA-019. |
| Right-pane survey management | **Low** | No changes to right-pane code. Verify QA-015. |
| Area tree on accounts without service_validations_enabled | **Low** | Checklists section conditional unchanged. Optionally verify QA-005. |
| Area tree prefetch/hover behavior | **Low** | No changes to prefetch logic. Expanding areas should still work smoothly. |

---

## 8. Rollback Plan

| Step | Action | Notes |
|------|--------|-------|
| Feature flag | No feature flag | This is a non-breaking visual enhancement. Rollback requires code revert. |
| Migration | No migrations | No database changes were made. Nothing to revert. |
| Code revert | Revert the 2 implementation commits on `pipeline/area-tree-type-headers` | The seed task commit (`a80de10`) can remain — it's harmless test data infrastructure. Revert `cebc815` (M1) to restore the original area tree rendering. |
| Data cleanup | Not needed | No new data structures were created. The seed task data can be deleted by removing structures with `job_number = 'pipeline-qa-atth'`. |

---

## QA Sign-Off

### Tester: ___________
### Date: ___________
### Status: Pending

- [ ] All manual test scenarios verified (QA-001 through QA-019)
- [ ] Edge cases tested (9 scenarios)
- [ ] Regression areas checked
- [ ] No blocking issues found

#### Issues Found
| # | Severity | Description | Status |
|---|----------|-------------|--------|
| | | | |

#### Notes
[Any observations, feedback, or suggestions from QA]
