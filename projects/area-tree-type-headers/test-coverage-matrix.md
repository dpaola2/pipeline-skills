# Test Coverage Matrix — Area Tree Type Headers & Icons

> **Generated by:** Pipeline Stage 4 (Test Generation)
> **Date:** February 6, 2026
> **Gameplan:** `projects/area-tree-type-headers/gameplan.md`

Maps every gameplan acceptance criterion to its test location(s).

---

## M1: Section Headers, Icons & Stimulus Updates

| Criterion ID                  | Description                                           | Test Type      | Test Location                                                                           | Notes                                                                                               |
| ----------------------------- | ----------------------------------------------------- | -------------- | --------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------- |
| HDR-001                       | Three section headers displayed                       | Manual QA      | M2 seed data                                                                            | Visual rendering — no controller logic to unit-test                                                 |
| HDR-002                       | Headers only when items exist                         | Manual QA      | M2 seed data                                                                            | Conditional ERB rendering — verified by inspecting areas with different assignment combinations     |
| HDR-003                       | Headers visually distinct                             | Manual QA      | M2 seed data                                                                            | CSS styling — not testable via RSpec                                                                |
| HDR-004                       | Order: inspections, surveys, checklists               | Manual QA      | M2 seed data                                                                            | DOM order — visual verification                                                                     |
| HDR-005                       | Checklists conditional on service_validations_enabled | Manual QA      | M2 seed data                                                                            | ERB conditional — seed task creates account with flag enabled                                       |
| ICN-001                       | Inspection forms use fa-file-alt                      | Manual QA      | M2 seed data                                                                            | Icon class in partial — visual verification                                                         |
| ICN-002                       | Surveys use fa-poll-h                                 | Manual QA      | M2 seed data                                                                            | Conditional icon in partial — visual verification                                                   |
| ICN-003                       | Checklists use fa-clipboard-list-check                | Manual QA      | M2 seed data                                                                            | Unchanged icon — visual verification                                                                |
| GRP-001                       | Split into non-surveys and surveys groups             | **Model spec** | `spec/models/inspection_forms_structures_surveys_scope_spec.rb` — `describe ".surveys"` | Tests the new `.surveys` scope that makes the split possible. ERB rendering verified via manual QA. |
| GRP-002                       | Sort order preserved within groups                    | Manual QA      | M2 seed data                                                                            | Uses existing `.ordered_by_form_name` scope (already tested)                                        |
| GRP-003                       | Checklists under Checklists header                    | Manual QA      | M2 seed data                                                                            | ERB template change — visual verification                                                           |
| INT-001                       | Dropdown insertion targets correct `<ul>`             | Manual QA      | M2 seed data                                                                            | Stimulus controller behavior — requires browser interaction                                         |
| INT-002                       | Expand/collapse unchanged                             | Manual QA      | M2 seed data                                                                            | Stimulus controller behavior — requires browser interaction                                         |
| INT-003                       | Assign buttons function unchanged                     | Manual QA      | M2 seed data                                                                            | Stimulus controller behavior — requires browser interaction                                         |
| INT-004                       | Dynamic section creation on first assignment          | Manual QA      | M2 seed data                                                                            | Stimulus `createSection()` helper — requires browser interaction                                    |
| INT-005                       | Sort/destroy methods target inspections list          | Manual QA      | M2 seed data                                                                            | Stimulus method targeting — requires browser interaction                                            |
| INT-006                       | Survey right-pane behavior unchanged                  | Manual QA      | M2 seed data                                                                            | Pre-existing behavior — verify tree doesn't update live                                             |
| BUG-FIX                       | `checklist` → `checklists` target fix                 | Manual QA      | M2 seed data                                                                            | One-token JS fix — verify checklists still sort correctly                                           |
| EDGE: No assignments          | No headers shown                                      | Manual QA      | M2 seed data                                                                            | Area with no assignments scenario in seed task                                                      |
| EDGE: Only surveys            | Only "Surveys" header                                 | Manual QA      | M2 seed data                                                                            | Area with only surveys scenario in seed task                                                        |
| EDGE: Only checklists         | Only "Checklists" header                              | Manual QA      | M2 seed data                                                                            | Area with only checklists scenario in seed task                                                     |
| EDGE: AJAX children           | Section headers on lazy-loaded nodes                  | Manual QA      | M2 seed data                                                                            | Nested area hierarchy scenario in seed task                                                         |
| EDGE: Last inspection removed | "Inspections" section disappears, "Add Area" visible  | Manual QA      | M2 seed data                                                                            | Stimulus destroy logic — requires browser interaction                                               |
| EDGE: Last survey removed     | "Surveys" section disappears                          | Manual QA      | M2 seed data                                                                            | Stimulus destroy logic — requires browser interaction                                               |

## M2: QA Test Data

| Criterion ID | Description | Test Type | Test Location | Notes |
|-------------|-------------|-----------|---------------|-------|
| Rake task exists | `pipeline:seed_area_tree_type_headers` | Manual | Run `rake -T pipeline:seed` | Verified by running the task |
| Account created | service_validations + surveys enabled | Manual | Run task, check output | Task prints summary |
| 8 area scenarios | All edge cases covered | Manual | Run task, expand areas in tree | Visual verification |
| User created | administer permission | Manual | Login with printed credentials | Task prints login/password |
| Idempotent | Re-run doesn't duplicate | Manual | Run task twice, check data | Task uses find_or_create pattern |

---

## Coverage Summary

| Category | Automated Tests | Manual QA Scenarios | Total |
|----------|:-:|:-:|:-:|
| Model scopes (GRP-001) | 3 | — | 3 |
| Visual/DOM rendering (HDR-*, ICN-*) | — | 8 | 8 |
| Stimulus interactions (INT-*) | — | 6 | 6 |
| Edge cases (EDGE) | — | 6 | 6 |
| Bug fix (BUG-FIX) | — | 1 | 1 |
| QA seed task (M2) | — | 5 | 5 |
| **Total** | **3** | **26** | **29** |

---

## Why Manual QA Dominates

The discovery report found **zero existing controller, feature, or JS specs** for the area tree. This project modifies 5 files, all view-layer:

1. **Model scope** (1 line) — testable via RSpec (**done**)
2. **ERB template restructure** — no controller logic changes; template rendering is verified by visual inspection
3. **Stimulus controller updates** — client-side JS; requires browser interaction to test
4. **ERB partial icon conditional** — simple `is_a?(Survey)` check; visual verification
5. **Inline CSS** — pure styling; visual verification

Building system/feature test infrastructure from scratch (Capybara with JS driver for Stimulus testing) would be disproportionate to the scope of this view-only change. The M2 seed task provides comprehensive QA scenarios covering all 8 area assignment combinations documented in the gameplan.

---

## iOS / Android

N/A — Level 2 (web-only) project. Both mobile platforms already have section headers.
