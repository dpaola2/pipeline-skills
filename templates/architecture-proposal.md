---
pipeline_stage: 2
pipeline_stage_name: architecture
pipeline_project: "[slug]"
pipeline_started_at: "[ISO 8601 timestamp]"
pipeline_completed_at: "[ISO 8601 timestamp]"
pipeline_approved_at: "[ISO 8601 timestamp — filled by Stage 3]"
---

# [Feature Name] - Architecture Proposal

> **Generated by:** Pipeline Stage 2 (Architecture)
> **Date:** [Date]
> **PRD:** [Link]
> **Discovery Report:** [Link]
> **Linear:** [Link]

---

## 1. Data Model Changes

### New Tables

```sql
CREATE TABLE [table_name] (
  id [primary key type per PIPELINE.md API Conventions],
  [column_name] [type] [constraints],
  [foreign_key]_id uuid NOT NULL REFERENCES [parent_table](id),
  created_at timestamptz NOT NULL DEFAULT NOW(),
  updated_at timestamptz NOT NULL DEFAULT NOW()
);

-- Indexes
CREATE INDEX idx_[table]_[column] ON [table_name] ([column]);
CREATE INDEX idx_[table]_[column] ON [table_name] ([column]);
```

### Modified Tables

```sql
-- Add columns to [existing_table]
ALTER TABLE [existing_table]
  ADD COLUMN [column_name] [type] [constraints];
```

### Models

```
[Model code following framework conventions from PIPELINE.md and the conventions file.
Include: associations/relationships, validations/constraints, scopes/queries, class methods.
If PIPELINE.md has Multi-Tenant Security, include the tenant-scoping scope/query.
Use the language and framework idioms from PIPELINE.md Framework & Stack.]
```

### Associations Map

```
[Parent] 1──* [Child] 1──* [Grandchild]
    │
    └── belongs_to [Account] (scoping)
```

### Migration Plan

| Migration | Type | Notes |
|-----------|------|-------|
| Create [table] | DDL | Standard table creation per framework conventions |
| Add index on [table.column] | DDL | Concurrent if supported by framework/database |
| Backfill [column] | Data | [Strategy: batch update, background job, etc.] |

### Expected Data Volumes

| Table | Expected Records | Access Frequency | Growth Rate |
|-------|-----------------|------------------|-------------|
| [table] | [estimate] | [reads/writes per day] | [per month] |

---

## 2. API Endpoints

<!-- CONDITIONAL: Include this section only if PIPELINE.md has an "API Conventions" section.
     Otherwise write: "N/A — this project does not expose an API." -->

### New Endpoints

#### [METHOD] /api/v1/[path]

**Purpose:** [What this endpoint does]

**Authorization:** [Who can call this, what permissions needed]

**Scoping:** [per PIPELINE.md Multi-Tenant Security, if applicable]

**Request:**
```json
{
  "[resource]": {
    "[field]": "[value]",
    "[field]": "[value]"
  }
}
```

**Response (2XX):**
```json
{
  "[resource]": {
    "id": "01234567-89ab-cdef-0123-456789abcdef",
    "[field]": "[value]",
    "[field]": "[value]",
    "created_at": "2026-02-05T14:30:00Z",
    "updated_at": "2026-02-05T14:30:00Z"
  }
}
```

**Error Response (422):**
```json
[Error format per PIPELINE.md API Conventions]
```

**Error Response (401):**
```json
[Error format per PIPELINE.md API Conventions]
```

---

#### [METHOD] /api/v1/[path]

[Repeat for each endpoint]

---

### Modified Endpoints

| Endpoint | Change | Backwards Compatible? |
|----------|--------|----------------------|
| [Existing endpoint] | [What changes] | Yes / No |

### Serializers

```
[Serializer code following the serialization framework from PIPELINE.md Framework & Stack
and patterns from the conventions file in the primary repository.
Include fields, associations, and custom formatting.]
```

---

## 3. Backwards Compatibility

<!-- CONDITIONAL: Include this section only if PIPELINE.md has a "Backwards Compatibility" section.
     Otherwise write: "N/A — no backwards compatibility concerns for this project." -->

### Compatibility Matrix

| Feature / Behavior | [Column per active platform and old version from PIPELINE.md Platforms] |
|-------------------|:---:|
| [Behavior 1] | [Full/Partial/None per platform] |
| [Behavior 2] | [Full/Partial/None per platform] |

### Old Client Behavior

> One subsection per platform with old versions (from PIPELINE.md Backwards Compatibility).

**[Platform] v[old]:**
- [What old client sees/doesn't see]
- [Any degraded functionality]
- [Any data that appears differently]

### API Versioning

[Does this change require API versioning? If so, what approach?]

### Data Migration

| Migration | Strategy | Rollback |
|-----------|----------|----------|
| [Existing data change] | [How: batch update, background job] | [How to undo] |

---

## 4. Security Design

### Query Scoping

<!-- CONDITIONAL: Include scoping chains only if PIPELINE.md has a "Multi-Tenant Security" section.
     Otherwise focus on authentication and authorization only. -->

| Resource | Scoping Chain |
|----------|--------------|
| [Resource] | [Scoping chain per PIPELINE.md Multi-Tenant Security, if applicable] |
| [Nested resource] | [Scoping chain, if applicable] |

### Authorization

| Action | Permitted Roles | Check |
|--------|----------------|-------|
| [Action 1] | [Admin, Manager, etc.] | [How verified] |
| [Action 2] | [Roles] | [How verified] |

### New Attack Surface

| Vector | Risk | Mitigation |
|--------|------|------------|
| [Vector] | [Risk level] | [How mitigated] |

---

## 5. Export Impact

<!-- CONDITIONAL: Include this section if the PRD mentions exports or the project has export features.
     Otherwise write: "N/A — no export impact." -->

| Export | Format | Changes | Backwards Compatible? |
|-------|--------|---------|----------------------|
| [Export name] | [PDF/Excel/CSV] | [What changes] | [Yes/No] |

---

## 6. Open Questions for Human Review

| # | Question | Options | Recommendation |
|---|----------|---------|---------------|
| 1 | [Decision needed] | A: [option] / B: [option] | [Agent's recommendation with rationale] |
| 2 | [Decision needed] | [Options] | [Recommendation] |

---

## 7. Alternatives Considered

### [Alternative Approach Name]

**Description:** [What the alternative was]
**Pros:** [Advantages]
**Cons:** [Disadvantages]
**Why rejected:** [Reason]

---

## 8. Summary

### Files to Create
| File | Purpose |
|------|---------|
| `[models dir from PIPELINE.md]/[model file]` | [Purpose] |
| `[controllers dir from PIPELINE.md]/[controller file]` | [Purpose] |
| `[serializers dir from PIPELINE.md]/[serializer file]` | [Purpose — if applicable] |
| `[migrations dir from PIPELINE.md]/[migration file]` | [Purpose] |

### Files to Modify
| File | Changes |
|------|---------|
| `[models dir from PIPELINE.md]/[existing_model file]` | Add association |
| `[routes path from PIPELINE.md]` | Add new routes |

---

## Approval Checklist

> **This architecture proposal requires human review and approval before the gameplan is generated.**

### Reviewer: [Name]
### Date: [Date]
### Status: [Pending / Approved / Approved with Modifications / Rejected]

#### Must Verify
- [ ] Data model is architecturally sound (tables, columns, relationships, constraints)
- [ ] API design is consistent with existing patterns (envelopes, error format, pagination)
- [ ] Backwards compatibility is handled correctly (compatibility matrix filled out)
- [ ] Security scoping is correct (all queries scoped to account, authorization checked)
- [ ] Migration strategy is safe (concurrent indexes, backfill approach)

#### Should Check
- [ ] Serializer design matches existing conventions
- [ ] Export impact is addressed
- [ ] Open questions are answerable
- [ ] API payloads are complete enough for mobile engineers to build against
- [ ] No conflicts with in-progress work or upcoming changes

#### Notes
[Reviewer notes, modifications requested, or rejection reasons]
